## Scala Microservice for Github Stats

A scala project to provide aggregated github metrics through a microservice. The project illustrates several key concepts of microservices implemented in scala:

- Clean Architecture by Bob Martin
- Hexagonal Architecture
- Developing containerized micro services with sbt plugins
- Scaling containerized micro services using a load balancer.


The project requires Java 11, Scala 2.13 and sbt 1.8.2+ environment to run.

### Build and Publish the microservice
 Use the following commands to get started with your project

 1. Compile the project
 
  `sbt compile`
 
 2. Run tests
 
 `sbt test`

 3. Install in local repo

`sbt publishLocal`

4. Stage the Docker files

Use the command below to stage the Docker files to review and debug the Docker image generated by sbt native packger.

`sbt docker:stage`

5. Publish Docker image to local

`sbt docker:publishLocal`

Ignore any errors if you see the message `Built image esumitra/github-stats-service with tags [0.1.0-SNAPSHOT]`

6. Publish Docker image to dockerhub

```
docker login
sbt docker:publish
```

### Run the microservice
1. Run single standalone instance

`docker run --rm -eGH_API_KEY=xxx -p8080:8080 esumitra/github-stats-service:0.1.0-SNAPSHOT`

2. Scale the service using a load balancer
`docker-compose up --scale gh-stats=3`

3. Test the service

User curl or Postman to testing a single instance of the service

```
curl -X GET -d '{"username": "edsum"}' http://localhost:8080/api/1.0/summary/user

curl -X GET -d '{"reponame": "samplerepo"}' http://localhost:8080/api/1.0/summary/repo
``` 

OR

`curl -X GET -d '{"username": "edsum"}' http://localhost:4000/api/1.0/summary/user` for testing scaled system with load balancer

4. Observability

To view the observability metrics provided by Prometheus open the page at http://localhost:9090 and search for `tapir_request_total`

### Static Analysis Tools

#### Scalafmt
To ensure clean code, run scalafmt periodically. The scalafmt configuration is defined at https://scalameta.org/scalafmt/docs/configuration.html

For source files,

`sbt scalafmt`

For test files.

`sbt test:scalafmt`

#### Scalafix
To ensure clean code, run scalafix periodically. The scalafix rules are listed at https://scalacenter.github.io/scalafix/docs/rules/overview.html

For source files,

`sbt "scalafix RemoveUnused"`

For test files.

`sbt "test:scalafix RemoveUnused"`

### License
Copyright 2023, esumitra

Licensed under the MIT License.
